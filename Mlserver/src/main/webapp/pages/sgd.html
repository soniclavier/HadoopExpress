<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>HEX-ML:SGD</title>

<!-- Bootstrap -->
<link rel="stylesheet"
	href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<!--  <link href="/css/bootstrap.min.css" rel="stylesheet"> -->
<link href="/css/jasny-bootstrap.min.css" rel="stylesheet"
	media="screen">
<link href="/css/navmenu-reveal.css" rel="stylesheet">
<link href="/css/bootstrap-slider.css" rel="stylesheet">
<link href="/css/menu-customize.css" rel="stylesheet">

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
	<div class="navmenu navmenu-grey navmenu-fixed-left">
		<a class="navmenu-brand" href="/pages/home.html">HexML</a>
		<ul class="nav navmenu-nav">
			<li><a href="/pages/home.html">Home</a></li>
			<li><a href="#">Overview</a></li>
			<li class="dropdown"><a href="#" class="dropdown-toggle"
				data-toggle="dropdown">HEX-Modeler<b class="caret"></b></a>
				<ul class="dropdown-menu navmenu-nav">
					<li><a href="#">Naive Bayes</a></li>
					<li><a href="/pages/sgd.html">Logistic Regression</a></li>
					<li><a href="#">Something else here</a></li>
				</ul></li>
		</ul>
	</div>
	<div class="canvas">
		<div class="navbar navbar-default navbar-fixed-top">
			<button type="button" class="navbar-toggle" data-toggle="offcanvas"
				data-recalc="false" data-target=".navmenu" data-canvas=".canvas">
				<span class="icon-bar"></span> <span class="icon-bar"></span> <span
					class="icon-bar"></span>
			</button>
		</div>

		<div class="container">
			<div class="page-header">
				<h1>HEX-ML Logistic Regression (SGD)</h1>
			</div>
			<p>Logistic regression is a model used for prediction of the
				probability of occurrence of an event. It makes use of several
				predictor variables that may be either numerical or categories.The
				Mahout implementation uses Stochastic Gradient Descent (SGD) to all
				large training sets to be used. SGD is an inherently sequential
				algorithm.</p>
			<br />
			<p>To use this Algorithm provide the path of your input data-set
				(with headers) from local file system and provide your target class
				name and type of the variables numeric or categorical.</p>
			<div class="box-with-border">
				<form>
					<div class="form-group">
						<div class="row">
							<label for="dataset">Choose input file</label>
						</div>
						<div class="row">
							<div class="col-lg-8">
								<input type="text" class="form-control" id="dataset"
									placeholder="Data set location in local file system.">
							</div>
							<!-- 
							<div class="col-lg-4">								
								<span class="btn btn-default btn-file">
								<span class="glyphicon glyphicon-folder-open"></span>
									Browse <input type="file" onchange="fillFilePath(this,'dataset');">
							</div>
							 -->
						</div>
						</span>
						<!-- <p class="help-block">Data set location in local file system.</p> -->
					</div>
					<div class="form-group">
						<div class="row">
							<label for="headers">Header information</label>
						</div>
						<div class="row">
							<div class="col-lg-8">
								<input type="text" class="form-control" id="header"
									placeholder="Comma separated header of input file">
							</div>
						</div>
					</div>
					<div class="form-group">
						<div class="row">
							<label for="targetClass">Target class name</label>
						</div>
						<div class="row">
							<div class="col-lg-8">
								<input type="text" class="form-control" id="targetClass"
									placeholder="Target class">
							</div>
						</div>
					</div>
					<div class="form-group">
						<div class="row">
							<label for="varType">Type of variable</label>
						</div>
						<div class="row">
							<div class="col-lg-8">
								<select class="form-control" id="varType">
									<option value="numeric">Numerical</option>
									<option value="categorical">Categorical</option>
								</select>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-lg-2">
							<button type="submit" id="generate" class="btn btn-default">Generate
								SGD-Model</button>
						</div>
						<div class="col-lg-2">
							<button type="submit" id="predict" class="btn btn-default"
								disabled>Predict</button>
						</div>
					</div>
				</form>

			</div>


			<div class="alert alert-success" role="alert" id="success"
				hidden="true">Model generated successfully</div>
			<div class="alert alert-danger" role="alert" id="error" hidden="true"></div>
			<div class="progress" hidden="true" id="progress">
				<div class="progress-bar progress-bar-striped active"
					role="progressbar" aria-valuenow="100" aria-valuemin="0"
					aria-valuemax="100" style="width: 100%">please wait</div>
			</div>
			<br />

			<div class="box-without-border no-padding" id="result" hidden="true">
				<span class="label label-info">Stats</span>
				<div class="well" id="resultStats"></div>
				<span class="label label-info">Confusion matrix</span>
				<table class="table table-hover table-bordered" id="confusionTable">
				</table>
			</div>

			<div class="box-with-border" id="predictContainer" hidden="true">
			</div>

			<div class="row" id="footer"><br/><br/><br/></div>
		</div>
		<!-- /.container -->
	</div>
	<script
		src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<script
		src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
	<!-- <script src="/js/bootstrap.min.js"></script>  -->
	<script src="/js/jasny-bootstrap.min.js"></script>
	<script src="/js/bootstrap-slider.js"></script>

	<script>
		function scrollToElement(selector, callback) {
			var animation = {
				scrollTop : $(selector).offset().top
			};
			$('html,body').animate(animation, 'slow', 'swing', function() {
				if (typeof callback == 'function') {
					callback();
				}
				callback = null;
			});
		}

		function fillFilePath(file, field) {
			var temp = file.value.split('\\');
			document.getElementById(field).value = temp[temp.length - 1];
		}

		function preGenerate() {
			$('#progress').show();
			$('#success').hide();
			$('#error').hide();
			$("#result").hide();
			$("#resultStats").hide();

		}

		$('#predict').click(function(e) {
			e.preventDefault();
			$('#predictContainer').show();
			scrollToElement('#predictContainer');

		});

		$('#generate').click(function(e) {
			e.preventDefault();
			var inputLoc = $('#dataset').val();
			var header = $('#header').val();
			var targetClass = $('#targetClass').val();
			var varType = $('#varType').val();
			$.ajax({
				type : "GET",
				contentType : "application/json",
				data : {
					'inputLoc' : inputLoc,
					'targetClass' : targetClass,
					'varType' : varType,
					'header' : header
				},
				async : true,
				url : "/rest/sgd/generateModel",
				beforeSend : preGenerate,
				success : function(data, textStatus, jqXHR) {
					$('#progress').hide();

					if (typeof (data.success) == "undefined") {
						$('#error').html(data.error[0])
						$('#error').show();
					} else {
						$('#predict').prop('disabled', false);
						$('#success').slideDown();
						$("#result").show();

						//build stats div
						populateStats(data);
						//Buid the confusion matrix
						populateConfusionMatrix(data);
						//build the features div
						populateFeatures(data);

					}

				},
				error : function(xhr, ajaxOptions, thrownError) {
					alert(xhr.status);
					alert(thrownError);
					alert(xhr.responseText);
				}
			});
		});

		//* function to populate the stats such as kappa, average *//
		function populateStats(data) {
			var resultStats = 'Kappa : ' + data.success[0].Kappa[0]
					+ "<br/>Standard Deviation : "
					+ data.success[0].StandardDeviation[0] + "<br/>Average : "
					+ data.success[0].Average[0];
			$("#resultStats").html(resultStats);
			$("#resultStats").show();

		}

		//* function to build the confusion matrix *//
		function populateConfusionMatrix(data) {
			var head = data.success[0].Categories[0].split(",");
			var thead = '<thead><tr><th></th>'
			for (i = 0; i < head.length; i++) {
				thead += '<th>' + head[i] + '</th>'
			}
			thead += '</tr></thead>'
			var tbody = '<tbody>'
			for (i = 0; i < head.length; i++) {
				tbody += '<tr><td style="font-weight: bold;">' + head[i]
						+ '</td>'
				for (j = 0; j < head.length; j++) {
					tbody += '<td>' + data.success[0].ConfusionMat[0][i][j]
							+ '</td>'
				}
				tbody += '</tr>'
			}
			tbody += '</tbody>'
			$("#confusionTable").html(thead + tbody);
		}

		//* function to populate the features div *//
		function populateFeatures(data) {
			var content = '';
			for (i = 0; i < data.features[0].length; i++) {
				content += '<div class=\"row\">';
				var name = data.features[0][i].name;
				content += '<div class=\"col-lg-2\">' + name + '</div>';
				var type = data.features[0][i].type[0].varType;
				if (type == 'numeric') {
					var min = data.features[0][i].type[0].min;
					var max = data.features[0][i].type[0].max;
					content += '<div class=\"col-lg-4\">'
					content += '<input id=\"'+name+'\" data-slider-id=\''+name+'\Slider\' type=\"text\" data-slider-min=\"'+min+'\" data-slider-max=\"'+max+'\" data-slider-step=\"1\"'
					content += 'data-slider-value=\"'+min+'\"'
					content += ' data-slider-handle=\"square\"'
					content += '/>'
					content += '</div>'
					$('#predictContainer').html(content);

					$('#' + name).slider({
						tooltip : 'always',
						formatter : function(value) {
							return value;
						}
					});
				}
				if (type == 'categorical') {
					var values = String(data.features[0][i].type[0].values)
							.split(",");
					for (k = 0; k < values.length; k++) {
						//
					}
				}
				content += '</div>';
			}

			//alert(content);

			//<input id="ex1" data-slider-id='ex1Slider' type="text" data-slider-min="0" data-slider-max="20" data-slider-step="1" data-slider-value="14"/>	

		}
	</script>
</body>
</html>